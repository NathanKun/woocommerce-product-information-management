<mat-sidenav-container class="w-100 h-100">
  <!-- Category Selector -->
  <mat-sidenav mode="side" opened>
    <mat-list>
      <mat-list-item>
        <button (click)="addCategoryOnClick()" mat-icon-button>
          <mat-icon>add</mat-icon>
        </button>
      </mat-list-item>
      <ng-container *ngFor="let catg of categories">
        <app-category-side-item [category]="catg" (selected)="editOnClick($event)"></app-category-side-item>
      </ng-container>
    </mat-list>
  </mat-sidenav>

  <!-- Category Editor -->
  <mat-sidenav-content>
    <!-- Toolbar -->
    <mat-toolbar *ngIf="selectedCategory" color="secondary">
      <button (click)="saveButtonOnclick(selectedCategory)" mat-icon-button aria-label="Save">
        <mat-icon>save</mat-icon>
      </button>
      <span>{{selectedCategory.name}}</span>
      <span class="toolbar-spacer"></span>
      <button (click)="deleteCategory(selectedCategory)" mat-icon-button aria-label="Delete">
        <mat-icon>delete</mat-icon>
      </button>
    </mat-toolbar>

    <div class="p-3" *ngIf="selectedCategory">

      <mat-grid-list cols="2" rowHeight="2:1">
        <mat-grid-tile>
          <div class="w-100 h-100">
            <a [href]="getCategoryImageSrc(selectedCategory)" target="_blank">
            <img class="category-img" [src]="getCategoryImageSrc(selectedCategory)" alt="category image of {{selectedCategory.name}}"/>
            </a>
          </div>
        </mat-grid-tile>
        <mat-grid-tile>
          <div class="w-100">
            <!-- 内部名 -->
            <mat-form-field appearance="fill">
              <mat-label>内部名</mat-label>
              <input matInput placeholder="内部名" [(ngModel)]="selectedCategory.name" required>
            </mat-form-field>

            <!-- 类别代码 -->
            <mat-form-field appearance="fill">
              <mat-label>类别代码</mat-label>
              <input matInput [(ngModel)]="selectedCategory.code" [disabled]="!editingNewCategory"
                     #scenarioName="ngModel" required pattern="[a-z0-9\-]+">
              <mat-error *ngIf="scenarioName.invalid">只可包含小写字母、数字和横杠，如 sample-category</mat-error>
            </mat-form-field>

            <!-- 父类别 -->
            <mat-form-field appearance="fill">
              <mat-label>父类别</mat-label>
              <mat-select [(value)]="selectedCategory.parentId">
                <mat-option *ngFor="let catg of categorySelectTree | keyvalue: keepOrderSort" [value]="catg.value">
                  <!-- keyvalue pipe will sort attr, so supply a keepOrderSort function to keep order -->
                  {{catg.key}}
                </mat-option>
              </mat-select>
            </mat-form-field>
          </div>
        </mat-grid-tile>
      </mat-grid-list>

      <!-- 可变属性 -->
      <ng-container *ngFor="let attr of selectedCategory.attributes">
        <mat-form-field appearance="fill">
          <mat-label>
            <app-flaged-attribute-name [name]="attr.name"></app-flaged-attribute-name>
          </mat-label>
          <input matInput [(ngModel)]="attr.value">
        </mat-form-field>
      </ng-container>

      <!-- 创建时间 -->
      <mat-form-field appearance="fill" *ngIf="!editingNewCategory">
        <mat-label>创建时间</mat-label>
        <input matInput [(ngModel)]="selectedCategory.createdAt" disabled>
      </mat-form-field>

      <!-- 上次修改 -->
      <mat-form-field appearance="fill" *ngIf="!editingNewCategory">
        <mat-label>上次修改</mat-label>
        <input matInput [(ngModel)]="selectedCategory.updatedAt" disabled>
      </mat-form-field>
    </div>
  </mat-sidenav-content>
</mat-sidenav-container>
